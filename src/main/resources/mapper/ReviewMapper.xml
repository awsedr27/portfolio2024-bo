<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.portfolioBo.review.dao.ReviewDao">
    <select id="selectReviewList" parameterType="com.portfolioBo.review.dto.ReviewDto$ReviewListQuery" resultType="com.portfolioBo.review.dto.ReviewDto">
        SELECT 
			review_id,
			product_id,
			user_id,
			use_yn,
			rating,
			comment,
			reply,
			create_date,
			modify_date
        FROM 
            review
        WHERE
            1=1
            <if test="reviewId != null">
                AND review_id = #{reviewId}
            </if>
            <if test="productId != null">
                AND product_id = #{productId}
            </if>
            <if test="userId != null and userId != ''">
                AND user_id = #{userId}
            </if>
            <if test="useYn != null and useYn != ''">
                AND use_yn = #{useYn}
            </if>
            ORDER BY create_date DESC
			LIMIT #{paging.startRecordIndex}, #{paging.pageSize}
    </select>
    <select id="selectReviewListCnt" parameterType="com.portfolioBo.review.dto.ReviewDto$ReviewListCntQuery" resultType="Integer">
        SELECT 
        	COUNT(*)
        FROM 
            review
        WHERE
            1=1
            <if test="reviewId != null">
                AND review_id = #{reviewId}
            </if>
            <if test="productId != null">
                AND product_id = #{productId}
            </if>
            <if test="userId != null and userId != ''">
                AND user_id = #{userId}
            </if>
            <if test="useYn != null and useYn != ''">
                AND use_yn = #{useYn}
            </if>
    </select>
    <select id="selectReview" parameterType="Integer" resultType="com.portfolioBo.review.dto.ReviewDto">
        SELECT 
			review_id,
			product_id,
			user_id,
			use_yn,
			rating,
			comment,
			reply,
			create_date,
			modify_date
        FROM 
            review
        WHERE
        	review_id=#{reviewId}
    </select>
    <update id="updateReview" parameterType="com.portfolioBo.review.dto.ReviewDto$ReviewUpdateQuery">
	    UPDATE review
		SET
	    reply = #{reply},
	    use_yn = #{useYn},
	    modify_date = NOW()
		WHERE
	    review_id = #{reviewId};
    </update>
</mapper>